import{H as h,d as oe,r as p,a as re,n as ne,g as d,I as se,o as x,c as ie,b as l,w as t,h as s,D as g,j as f,q as N,z as R,m as T,F as de,C as O,J as U,p as ue,k as ce,_ as pe}from"./index-HtYYoKz9.js";import{u as me}from"./setting-DRRv7okC.js";const fe=(o,y,u)=>h.get(`/admin/acl/role/${o}/${y}/?roleName=${u}`),_e=o=>o.id?h.put("/admin/acl/role/update",o):h.post("/admin/acl/role/save",o),ve=o=>h.get("/admin/acl/permission/toAssign/"+o),ge=(o,y)=>h.post(`/admin/acl/permission/doAssign/?roleId=${o}&permissionId=${y}`),ye=o=>h.delete("/admin/acl/role/remove/"+o),be=o=>(ue("data-v-d99ae7f4"),o=o(),ce(),o),ke=be(()=>T("h4",null,"分配菜单与按钮的权限",-1)),he={style:{flex:"auto"}},we=oe({__name:"index",setup(o){let y=me(),u=p(1),w=p(10),v=p(""),S=p([]),A=p(0),m=p(!1),V=p(),_=p(!1),i=re({roleName:""}),P=p([]),I=p([]),q=p();ne(()=>{b()});const b=async(r=1)=>{u.value=r;let e=await fe(u.value,w.value,v.value);e.code==200&&(A.value=e.data.total,S.value=e.data.records)},B=()=>{b()},H=()=>{b(),v.value=""},L=()=>{y.refsh=!y.refsh},M=()=>{m.value=!0,Object.assign(i,{roleName:"",id:0}),O(()=>{V.value.clearValidate("roleName")})},F=r=>{m.value=!0,Object.assign(i,r),O(()=>{V.value.clearValidate("roleName")})},K={roleName:[{required:!0,trigger:"blur",validator:(r,e,n)=>{e.trim().length>=2?n():n(new Error("职位名称至少两位"))}}]},J=async()=>{await V.value.validate(),(await _e(i)).code==200&&(U({type:"success",message:i.id?"更新成功":"添加成功"}),m.value=!1,b(i.id?u.value:1))},G=async r=>{_.value=!0,Object.assign(i,r);let e=await ve(i.id);e.code==200&&(I.value=e.data,P.value=$(I.value,[]))},Q={children:"children",label:"name"},$=(r,e)=>(r.forEach(n=>{n.select&&n.level==4&&e.push(n.id),n.children&&n.children.length>0&&$(n.children,e)}),e),W=async()=>{const r=i.id;let e=q.value.getCheckedKeys(),n=q.value.getHalfCheckedKeys(),C=e.concat(n);(await ge(r,C)).code==200&&(_.value=!1,U({type:"success",message:"分配权限成功"}),window.location.reload())},X=async r=>{(await ye(r)).code==200&&(U({type:"success",message:"删除成功"}),b(S.value.length>1?u.value:u.value-1))};return(r,e)=>{const n=d("el-input"),C=d("el-form-item"),c=d("el-button"),j=d("el-form"),D=d("el-card"),k=d("el-table-column"),Y=d("el-popconfirm"),Z=d("el-table"),ee=d("el-pagination"),le=d("el-dialog"),te=d("el-tree"),ae=d("el-drawer"),z=se("btn");return x(),ie(de,null,[l(D,null,{default:t(()=>[l(j,{inline:!0,class:"form"},{default:t(()=>[l(C,{label:"职位搜索"},{default:t(()=>[l(n,{placeholder:"请你输入搜索职位关键字",modelValue:s(v),"onUpdate:modelValue":e[0]||(e[0]=a=>g(v)?v.value=a:v=a)},null,8,["modelValue"])]),_:1}),l(C,null,{default:t(()=>[l(c,{type:"primary",size:"default",disabled:!s(v),onClick:H},{default:t(()=>[f("搜索")]),_:1},8,["disabled"]),l(c,{type:"primary",size:"default",onClick:L},{default:t(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{style:{margin:"10px 0px"}},{default:t(()=>[N((x(),R(c,{type:"primary",size:"default",icon:"Plus",onClick:M},{default:t(()=>[f("添加职位")]),_:1})),[[z,"btn.Role.add"]]),l(Z,{border:"",style:{margin:"10px 0px"},data:s(S)},{default:t(()=>[l(k,{type:"index",align:"center",label:"#"}),l(k,{label:"ID",align:"center",prop:"id"}),l(k,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(k,{label:"创建世间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(k,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(k,{label:"操作",width:"280px",align:"center"},{default:t(({row:a})=>[N((x(),R(c,{type:"primary",size:"small",icon:"User",onClick:E=>G(a)},{default:t(()=>[f("分配权限")]),_:2},1032,["onClick"])),[[z,"btn.Role.assgin"]]),N((x(),R(c,{type:"primary",size:"small",icon:"Edit",onClick:E=>F(a)},{default:t(()=>[f("编辑")]),_:2},1032,["onClick"])),[[z,"btn.Role.update"]]),l(Y,{title:`你确定要删除${a.roleName}?`,width:"260px",onConfirm:E=>X(a.id)},{reference:t(()=>[N((x(),R(c,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[f("删除")]),_:1})),[[z,"btn.Role.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(ee,{"current-page":s(u),"onUpdate:currentPage":e[1]||(e[1]=a=>g(u)?u.value=a:u=a),"page-size":s(w),"onUpdate:pageSize":e[2]||(e[2]=a=>g(w)?w.value=a:w=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:s(A),onCurrentChange:b,onSizeChange:B},null,8,["current-page","page-size","total"])]),_:1}),l(le,{modelValue:s(m),"onUpdate:modelValue":e[5]||(e[5]=a=>g(m)?m.value=a:m=a),title:s(i).id?"更新职位":"添加职位"},{footer:t(()=>[l(c,{type:"primary",size:"default",onClick:e[4]||(e[4]=a=>g(m)?m.value=!1:m=!1)},{default:t(()=>[f("取消")]),_:1}),l(c,{type:"primary",size:"default",onClick:J},{default:t(()=>[f("确定")]),_:1})]),default:t(()=>[l(j,{model:s(i),rules:K,ref_key:"form",ref:V},{default:t(()=>[l(C,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(n,{placeholder:"请你输入职位名称",modelValue:s(i).roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>s(i).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(ae,{modelValue:s(_),"onUpdate:modelValue":e[7]||(e[7]=a=>g(_)?_.value=a:_=a)},{header:t(()=>[ke]),default:t(()=>[l(te,{ref_key:"tree",ref:q,data:s(I),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":s(P),props:Q},null,8,["data","default-checked-keys"])]),footer:t(()=>[T("div",he,[l(c,{onClick:e[6]||(e[6]=a=>g(_)?_.value=!1:_=!1)},{default:t(()=>[f("取消")]),_:1}),l(c,{type:"primary",onClick:W},{default:t(()=>[f("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),ze=pe(we,[["__scopeId","data-v-d99ae7f4"]]);export{ze as default};
