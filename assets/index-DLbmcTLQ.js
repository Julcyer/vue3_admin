import{d as R,L as G,r as k,a as H,B as K,M as Q,g as i,I as W,o as _,c as x,b as e,h as n,w as l,q as v,m as I,z as L,j as f,F as X,y as Y,t as B,v as O,C as S,N as Z,J as y,O as ee,P as te}from"./index-D0gkGGaH.js";const ae=["onClick"],se=R({__name:"index",setup(le){let p=G(),b=k([]),u=k(0),t=H({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),V=k([]);K(()=>p.c3Id,()=>{b.value=[],p.c3Id&&N()});const N=async()=>{const{c1Id:r,c2Id:o,c3Id:g}=p;let s=await te(r,o,g);s.code==200&&(b.value=s.data)},D=()=>{Object.assign(t,{attrName:"",attrValueList:[],categoryId:p.c3Id,categoryLevel:3}),u.value=1},U=r=>{u.value=1,Object.assign(t,JSON.parse(JSON.stringify(r)))},h=()=>{u.value=0},q=()=>{t.attrValueList.push({valueName:"",flag:!0}),S(()=>{V.value[t.attrValueList.length-1].focus()})},E=async()=>{(await Z(t)).code==200?(u.value=0,y({type:"success",message:t.id?"修改成功":"添加成功"}),N()):y({type:"error",message:t.id?"修改失败":"添加失败"})},P=(r,o)=>{if(r.valueName.trim()==""){t.attrValueList.splice(o,1),y({type:"error",message:"属性值不能为空"});return}if(t.attrValueList.find(s=>{if(s!=r)return s.valueName===r.valueName})){t.attrValueList.splice(o,1),y({type:"error",message:"属性值不能重复"});return}r.flag=!1},$=(r,o)=>{r.flag=!0,S(()=>{V.value[o].focus()})},j=async r=>{(await ee(r)).code==200?(y({type:"success",message:"删除成功"}),N()):y({type:"error",message:"删除失败"})};return Q(()=>{p.$reset()}),(r,o)=>{const g=i("Category"),s=i("el-button"),d=i("el-table-column"),w=i("el-tag"),J=i("el-popconfirm"),A=i("el-table"),z=i("el-input"),F=i("el-form-item"),M=i("el-form"),T=i("el-card"),C=W("btn");return _(),x("div",null,[e(g,{scene:n(u)},null,8,["scene"]),e(T,{style:{margin:"10px 0px"}},{default:l(()=>[v(I("div",null,[v((_(),L(s,{onClick:D,type:"primary",size:"default",icon:"Plus",disabled:!n(p).c3Id},{default:l(()=>[f("添加属性")]),_:1},8,["disabled"])),[[C,"btn.Attr.add"]]),e(A,{border:"",style:{margin:"10px 0px"},data:n(b)},{default:l(()=>[e(d,{label:"序号",type:"index",align:"center",width:"80px"}),e(d,{label:"属性名称",width:"120px",prop:"attrName"}),e(d,{label:"属性值名称"},{default:l(({row:a})=>[(_(!0),x(X,null,Y(a.attrValueList,(c,m)=>(_(),L(w,{style:{margin:"5px"},key:c.id},{default:l(()=>[f(B(c.valueName),1)]),_:2},1024))),128))]),_:1}),e(d,{label:"操作",width:"120px"},{default:l(({row:a})=>[v(e(s,{type:"primary",size:"small",icon:"Edit",onClick:c=>U(a)},null,8,["onClick"]),[[C,"btn.Attr.update"]]),e(J,{title:`你确定删除${a.attrName}?`,width:"200px",onConfirm:c=>j(a.id)},{reference:l(()=>[v(e(s,{type:"primary",size:"small",icon:"Delete"},null,512),[[C,"btn.Attr.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[O,n(u)==0]]),v(I("div",null,[e(M,{inline:!0},{default:l(()=>[e(F,{label:"属性名称"},{default:l(()=>[e(z,{placeholder:"请你输入属性名称",modelValue:n(t).attrName,"onUpdate:modelValue":o[0]||(o[0]=a=>n(t).attrName=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{onClick:q,disabled:!n(t).attrName,type:"primary",size:"default",icon:"Plus"},{default:l(()=>[f("添加属性值")]),_:1},8,["disabled"]),e(s,{type:"primary",size:"default",onClick:h},{default:l(()=>[f("取消")]),_:1}),e(A,{border:"",style:{margin:"10px 0px"},data:n(t).attrValueList},{default:l(()=>[e(d,{label:"序号",width:"80px",type:"index",align:"center"}),e(d,{label:"属性值名称"},{default:l(({row:a,$index:c})=>[a.flag?(_(),L(z,{key:0,ref:m=>n(V)[c]=m,onBlur:m=>P(a,c),size:"small",placeholder:"请你输入属性值名称",modelValue:a.valueName,"onUpdate:modelValue":m=>a.valueName=m},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(_(),x("div",{key:1,onClick:m=>$(a,c)},B(a.valueName),9,ae))]),_:1}),e(d,{label:"属性值操作"},{default:l(({index:a})=>[e(s,{type:"primary",size:"small",icon:"Delete",onClick:c=>n(t).attrValueList.splice(a,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(s,{type:"primary",size:"default",onClick:E,disabled:!(n(t).attrValueList.length>0)},{default:l(()=>[f("保存")]),_:1},8,["disabled"]),e(s,{type:"primary",size:"default",onClick:h},{default:l(()=>[f("取消")]),_:1})],512),[[O,n(u)==1]])]),_:1})])}}});export{se as default};
